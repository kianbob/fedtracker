# CLAUDE.md — FedTracker

Next.js 14 App Router project with TypeScript + Tailwind. Federal workforce data site.

## Key Info
- **Build**: `npm run build` — must pass before pushing
- **Data files**: `public/data/` — JSON files generated by DuckDB scripts
- **Light theme**: White/light gray backgrounds, Playfair Display serif headings, indigo accent (#4F46E5)
- **Shared chart component**: `src/components/Charts.tsx` (Recharts)
- **Format helpers**: `src/lib/format.ts` (formatNumber, formatSalary, formatMonth, cleanAgencyName)
- **NEVER use CSS-only fade/opacity animations** — breaks SSR. Use JS intersection observer if needed.
- **DO NOT export constants from "use client" components** for use in server components — inline values.
- `force-dynamic` used on workforce-analysis page to avoid prerender crashes on undefined data fields
- **Education labels, occupation names, subagency names** from OPM are ALL CAPS — always convert to Title Case for display
- **Military agencies** (DD, AR, AF, NV) have REDACTED salary data — show "N/A" not "$0"
- Format helper handles null salary: formatSalary(null) → "N/A"

## Current Audit Fixes Needed (Feb 2025)

### Priority 1: ALL CAPS → Title Case
- Occupation names on separation type pages (`/separations/[code]`) — ALL CAPS in "Top Occupations" list
- Age bracket labels ("LESS THAN 20", "65 OR MORE") on separation type and occupation detail pages
- Education level labels on demographics page and occupation detail pages
- Bar chart Y-axis labels (Top Agencies, Top Occupations charts) throughout

### Priority 2: Truncated Text
- "Top Agency" stat card on separation detail pages truncates names ("Department of Health and" — cuts off "Human Services"). The stat card needs to either use a smaller font for long names or abbreviate intelligently.
- Agency names in Trends page "Biggest Net Losses/Gains" tables — "Department Of Health And Human Serv" truncated, "Dfc" appears (should be full name), inconsistent Title Case ("Department Of The Treasury" should be "Department of the Treasury")
- Bar chart Y-axis labels overlap/truncate on occupation pages and separation type pages

### Priority 3: Charts
- Education pie/donut chart labels overlap on occupation detail pages — long labels like "FOUR YEARS COLLEGE OR CERTIFICATE OF EQUIVALENCY" overlap each other. Consider using a legend below instead of inline labels.
- Salaries page "Average Salary by GS Grade" chart shows raw codes. Format as "GS-5" through "GS-15" for GS pay plan. Filter to only show GS grades (remove DH, EH, FH, etc.) since that's what users care about.

### Priority 4: Nav
- 11 nav items is too many. Group "Deep Dive", "Key Findings", and "Demographics" under an "Analysis" dropdown, leaving 8 top-level items.

### Priority 5: Missing data
- Military agency pages (DD, AR, AF, NV) have empty topOccupations and topStates arrays. These need to be populated. We can generate them from the enriched subagency data or from the employment file.
